{% extends "base.html" %}
{% block title %}Dashboard Capitano{% endblock %}

{% block page_title %}
<h1 class="fw-bold text-primary m-0">
  <i class="bi bi-person-circle me-2"></i>
  Dashboard Capitano
</h1>
{% endblock %}

{% block content %}
<div class="container py-2">
    <h2>Benvenuto nella tua Dashboard Capitano!</h2>
    <p>Qui potrai visualizzare le informazioni relative alla tua squadra e gestire la lineup.</p>
    
    {% if current_user.captain_of_team %}
        <h3>La tua Squadra: {{ current_user.captain_of_team.name }}</h3>
        <p>TRC: {{ current_user.captain_of_team.trc }}</p>
        <p>Categoria: {{ current_user.captain_of_team.category }}</p>
        <p>Divisione: {{ current_user.captain_of_team.division }}</p>
        
        <a href="{{ url_for('admin_bp.manage_lineup', trc=current_user.captain_of_team.trc, race_date='next') }}" class="btn btn-primary mt-3">Gestisci Lineup</a>
    {% else %}
        <p class="alert alert-warning">Il tuo account capitano non è ancora associato a nessuna squadra. Contatta un amministratore.</p>
    {% endif %}

    <h4 class="mt-4">Prossima Gara ZRL: {{ next_race.name if next_race else 'N/A' }}</h4>
    <p class="lead">Data: {{ next_race_date.strftime('%d/%m/%Y') }}</p>

    {% if next_race %}
        <h5>Riders Disponibili per {{ next_race.name }} ({{ next_race_date.strftime('%d/%m/%Y') }})</h5>
        {% if available_riders %}
            <table class="table table-striped table-hover mt-3">
                <thead>
                    <tr>
                        <th>Rider</th>
                        <th>Squadra</th>
                        <th>Disponibilità</th>
                        <th>Note</th>
                        <th>Seleziona</th> {# Placeholder for selection #}
                    </tr>
                </thead>
                <tbody>
                    {% for rider in available_riders %}
                    <tr>
                        <td>{{ rider.rider_name }}</td>
                        <td>{{ rider.team_name }}</td>
                        <td>
                            {% if rider.availability_start and rider.availability_end %}
                                {{ rider.availability_start }} - {{ rider.availability_end }}
                            {% else %}
                                Intera Giornata
                            {% endif %}
                        </td>
                        <td>{{ rider.notes }}</td>
                        <td><input type="checkbox" name="selected_riders" value="{{ rider.wtrl_rider_id }}"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="alert alert-info">Nessun rider ha dato disponibilità per il prossimo martedì.</p>
        {% endif %}
    {% else %}
        <p class="alert alert-warning">Nessuna gara ZRL trovata per il prossimo martedì.</p>
    {% endif %}

    <h4 class="mt-4">Report</h4>
    <p>Puoi accedere ai report <a href="{{ url_for('admin_bp.index') }}">cliccando qui</a>.</p>
</div>
{% endblock %}
